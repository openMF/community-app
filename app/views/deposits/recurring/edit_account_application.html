<div class="col-md-12" ng-controller="EditRecurringDepositAccountController">
    <ul class="breadcrumb">
        <li><a href="#/viewrecurringdepositaccount/{{accountId}}">{{'label.anchor.viewrecurringdepositaccount' | translate}}</a></li>
        <li class="active">{{'label.anchor.editrecurringdepositapplication' | translate}}</li>
    </ul>

    <api-validate></api-validate>
    <form name="editrecurringdepositaccountform" class="form-horizontal well" novalidate="" rc-submit="submit()">
        <legend>{{'label.heading.editrecurringdepositapplication' | translate}}</legend>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.product' | translate}}<span class="required">*</span></label>
            <div class="col-sm-3">
                <select id="productId" class="form-control" ng-model="formData.productId" ng-options="product.id as product.name for product in products" ng-change="changeProduct()"></select>
            </div>

            <label class="control-label col-sm-2">{{'label.input.submittedon' | translate}}<span class="required">*</span></label>
            <div class="col-sm-2">
                <input id="submittedOnDate" type="text" class="form-control" required ng-model="formData.submittedOnDate" datepicker-pop="dd MMMM yyyy" is-open="opened" min="minDate" max="restrictDate" sort>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.fieldofficer' | translate}}</label>
            <div class="col-sm-3">
                <select id="fieldOfficerId" class="form-control" ng-model="formData.fieldOfficerId" ng-options="fieldOfficer.id as fieldOfficer.displayName for fieldOfficer in fieldOfficers">
                    <option value="">{{'label.selectfieldofficer' | translate}}</option>
                </select>
            </div>
        </div>

        <hr>
        <h3>{{'label.heading.terms' | translate}}</h3>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.heading.currency' | translate}}</label>
            <span class="col-sm-2">{{data.currency.name}} ({{data.currency.displaySymbol}})</span>

            <label class="control-label col-sm-3">{{'label.heading.decimalplaces' | translate}}</label>
            <span class="col-sm-2">{{data.currency.decimalPlaces}}</span>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.interestcompoundingperiod' | translate}}<span class="required">*</span></label>
            <div class="col-sm-2">
                <select id="interestCompoundingPeriodType" class="form-control" ng-model="formData.interestCompoundingPeriodType" ng-options="type.id as type.value for type in data.interestCompoundingPeriodTypeOptions"></select>
            </div>

            <label class="control-label col-sm-3">{{'label.input.interestpostingperiod' | translate}}<span class="required">*</span></label>
            <div class="col-sm-2">
                <select id="interestPostingPeriodType" class="form-control" ng-model="formData.interestPostingPeriodType" ng-options="type.id as type.value for type in data.interestPostingPeriodTypeOptions"></select>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.interestcalculatedusing' | translate}}<span class="required">*</span></label>
            <div class="col-sm-2">
                <select id="interestCalculationType" class="form-control" ng-model="formData.interestCalculationType" ng-options="type.id as type.value for type in data.interestCalculationTypeOptions"></select>
            </div>

            <label class="control-label col-sm-3">{{'label.input.daysinyears' | translate}}<span class="required">*</span></label>
            <div class="col-sm-2">
                <select id="interestCalculationDaysInYearType" class="form-control" ng-model="formData.interestCalculationDaysInYearType" ng-options="type.id as type.value for type in data.interestCalculationDaysInYearTypeOptions"></select>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.lockinPeriodFrequency' | translate}}</label>
            <div class="col-sm-4 form-inline">
                <input id="lockinPeriodFrequency" type="text" class="form-control" ng-model="formData.lockinPeriodFrequency">
                <select id="lockinPeriodFrequencyType" class="form-control" ng-model="formData.lockinPeriodFrequencyType" ng-options="type.id as type.value for type in data.lockinPeriodFrequencyTypeOptions">
                    <option value="">{{'label.selectone' | translate}}</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.checkbox.ismandatory.deposit' | translate}}</label>
            <input id="isMandatoryDeposit" type="checkbox" class="col-sm-1" ng-model="formData.isMandatoryDeposit">

            <label class="control-label col-sm-2">{{'label.checkbox.allowWithdrawal' | translate}}</label>
            <input id="allowWithdrawal" type="checkbox" class="col-sm-1" ng-model="formData.allowWithdrawal">

            <label class="control-label col-sm-2">{{'label.checkbox.adjustAdvanceTowardsFuturePayments' | translate}}</label>
            <input id="adjustAdvanceTowardsFuturePayments" type="checkbox" class="col-sm-1" ng-model="formData.adjustAdvanceTowardsFuturePayments">
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.mandatory.recommended.deposit.amount' | translate}}<span class="required">*</span></label>
            <div class="col-sm-2">
                <input id="mandatoryRecommendedDepositAmount" type="text" class="form-control" ng-model="formData.mandatoryRecommendedDepositAmount" number-format>
            </div>

            <label class="control-label col-sm-3">{{'label.input.depositperiod' | translate}}</label>
            <div class="col-sm-4 form-inline">
                <input id="depositPeriod" type="text" class="form-control" ng-model="formData.depositPeriod">
                <select id="depositPeriodFrequencyId" class="form-control" ng-model="formData.depositPeriodFrequencyId" ng-options="type.id as type.value for type in data.periodFrequencyTypeOptions">
                    <option value="">{{'label.selectone' | translate}}</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{ 'label.input.same.as.group.meeting' | translate }}</label>
            <input id="isCalendarInherited" type="checkbox" class="col-sm-1" ng-model="formData.isCalendarInherited" ng-disabled=true>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.deposit.start.date' | translate}}</label>
            <div class="col-sm-2">
                <input id="expectedFirstDepositOnDate" type="text" class="form-control" ng-model="formData.expectedFirstDepositOnDate" datepicker-pop="dd MMMM yyyy" is-open="opened" min="minDate" sort>
            </div>

            <label class="control-label col-sm-3">{{'label.input.recurring.frequency' | translate}}</label>
            <div class="col-sm-4 form-inline">
                <input id="recurringFrequency" class="form-control" type="text" ng-model="formData.recurringFrequency">
                <select id="recurringFrequencyType" class="form-control" ng-model="formData.recurringFrequencyType" ng-options="type.id as type.value for type in data.periodFrequencyTypeOptions">
                    <option value="">{{'label.selectone' | translate}}</option>
                </select>
            </div>
        </div>

        <hr>
        <h3>{{'label.heading.settings' | translate}}</h3>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.minimumdepositterm' | translate}}</label>
            <span class="col-sm-2">{{formData.minDepositTerm}} {{data.minDepositTermType.value}}</span>

            <label class="control-label col-sm-3">{{'label.input.inmultiplesof' | translate}}</label>
            <span class="col-sm-2">{{formData.inMultiplesOfDepositTerm}} {{data.inMultiplesOfDepositTermType.value}}</span>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.maximumdepositterm' | translate}}</label>
            <span class="col-sm-2">{{formData.maxDepositTerm}} {{data.maxDepositTermType.value}}</span>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.prematureclosure' | translate}}</label>
            <span class="col-sm-5" ng-show="formData.preClosurePenalApplicable">{{'label.checkbox.applypreclosurepenalinterest' | translate}} {{formData.preClosurePenalInterest | number}} - On {{data.preClosurePenalInterestOnType.value}}</span>
        </div>

        <div class="form-group" ng-show="data.minBalanceForInterestCalculation">
            <label class="control-label col-sm-2">{{'label.heading.minbalanceforinterestcalculation' | translate}}</label>
            <span class="col-sm-2">{{data.minBalanceForInterestCalculation | number}}</span>
        </div>

        <hr>
        <h3>{{'label.heading.interestchart' | translate}}</h3>

        <div class="form-group">
            <label class="control-label col-sm-2">{{'label.input.interestratechart.valid.from' | translate}}</label>
            <span class="col-sm-2">{{fromDate.date | DateFormat}}</span>

            <div ng-show="endDate.date">
                <label class="control-label col-sm-3">{{'label.input.interestratechart.valid.to' | translate}}</label>
                <span class="col-sm-2">{{endDate.date | DateFormat}}</span>
            </div>
        </div>

        <table class="table">
            <tr class="graybg">
                <th>{{'label.heading.interestratedetails.period.type' | translate}}</th>
                <th>{{'label.heading.interestratedetails.period.from.to' | translate}}</th>
                <th>{{'label.heading.interestratedetails.interest' | translate}}</th>
                <th>{{'label.heading.interestratedetails.description' | translate}}</th>
                <th></th>
            </tr>
            <tr ng-repeat="chartSlab in chart.chartSlabs">
                <td>{{chartSlab.periodType.value}}</td>
                <td>{{chartSlab.fromPeriod}}-{{chartSlab.toPeriod}}</td>
                <td>{{chartSlab.annualInterestRate}}</td>
                <td>{{chartSlab.description}}</td>
                <td><a ng-click="incentives($index)"><i class="icon-white"></i>{{'label.incentive.row' | translate}}</a></td>
            </tr>
        </table>

        <script type="text/ng-template" id="incentive.html">
            <div class="modal-header silver">
                <h3 class="bolder">{{'label.heading.incentives' | translate}}</h3>
                <h3 class="bolder">{{'label.heading.customerattributes' | translate}}</h3>

                <table class="table">
                    <tr class="graybg">
                        <th>{{'label.heading.interestratedetails.incentive.attributename' | translate}}</th>
                        <th>{{'label.heading.interestratedetails.incentive.conditiontype' | translate}}</th>
                        <th>{{'label.heading.interestratedetails.incentive.attributevalue' | translate}}</th>
                        <th>{{'label.heading.interestratedetails.incentive.incentivetype' | translate}}</th>
                        <th>{{'label.heading.interestratedetails.incentive.amount' | translate}}</th>
                    </tr>
                    <tr ng-repeat="incentiveData in chartSlab.incentives">
                        <td>{{incentiveData.attributeName.code | translate}}</td>
                        <td>{{incentiveData.conditionType.code | translate}}</td>
                        <td>{{incentiveData.attributeValueDesc}}</td>
                        <td>{{incentiveData.incentiveType.code | translate}}</td>
                        <td>{{incentiveData.amount | number}}</td>
                    </tr>
                </table>
            </div>

            <div class="modal-footer">
                <button class="btn btn-warning" ng-click="cancel()">{{'label.button.close' | translate}}</button>
            </div>
        </script>

        <hr>
        <h3>{{'label.heading.charges' | translate}}</h3>

        <div class="form-group">
            <div class="col-sm-3">
                <select class="form-control" ng-model="chargeId" ng-options="charge.id as (charge.name + ' (' + charge.currency.displaySymbol + ')') for charge in data.chargeOptions|filter:data.currency.code:strict">
                    <option class="displaynone" value="">{{'label.selectcharge' | translate}}</option>
                </select>
            </div>
            <a class="btn btn-primary" ng-click="addCharge(chargeId)"><i class="icon-plus icon-white"></i> {{'label.button.add' | translate}}</a>
            <span class="error" ng-show="errorchargeevent">{{'label.' + labelchargeerror | translate}}</span>
        </div>

        <table class="table" ng-show="charges.length > 0">
            <tr class="graybg">
                <th>{{'label.heading.name' | translate}}</th>
                <th>{{'label.heading.type' | translate}}</th>
                <th>{{'label.heading.amount' | translate}}</th>
                <th>{{'label.heading.collectedon' | translate}}</th>
                <th>{{'label.heading.date' | translate}}</th>
                <th>{{'label.heading.repaymentsevery' | translate}}</th>
                <th>{{'label.heading.actions' | translate}}</th>
            </tr>
            <tr ng-repeat="charge in charges">
                <td>{{charge.name}} ({{charge.currency.displaySymbol}})</td>
                <td>{{charge.chargeCalculationType.value}}</td>
                <td><input id="charges[{{$index}}].amount" type="text" class="form-control" placeholder="{{'label.placeholder.amount' | translate}}" ng-model="charge.amount" number-format></td>
                <td>{{charge.chargeTimeType.value}}</td>
                <td ng-show="charge.chargeTimeType.value == 'Annual Fee'">
                    <input id="charges[{{$index}}].feeOnMonthDay" type="text" class="date-disable form-control" ng-model="charge.feeOnMonthDay" datepicker-pop="dd MMMM" is-open="opened">
                </td>
                <td ng-show="charge.chargeTimeType.value == 'Specified due date'">
                    <input id="charges[{{$index}}].dueDate" type="text" class="date-disable form-control" ng-model="charge.dueDate" datepicker-pop="dd MMMM yyyy" is-open="opened">
                </td>
                <td ng-show="charge.chargeTimeType.value == 'Monthly Fee'">
                    <input type="text" class="date-disable form-control" ng-model="charge.feeOnMonthDay" datepicker-pop="dd MMMM" is-open="opened">
                </td>
                <td ng-show="charge.chargeTimeType.value == 'Monthly Fee'">
                    <input id="charges[{{$index}}].amount" type="text" class="form-control" ng-model="charge.feeInterval" number-format>
                </td>
                <td ng-hide="charge.chargeTimeType.value == 'Monthly Fee'"></td>
                <td ng-hide="charge.chargeTimeType.value == 'Annual Fee' || charge.chargeTimeType.value == 'Specified due date' || charge.chargeTimeType.value == 'Monthly Fee'"></td>
                <td><a ng-click="deleteCharge($index)"><i class="icon-remove icon-white"></i></a></td>
            </tr>
        </table>

        <div class="text-center">
            <button id="cancel" class="btn btn-default" ng-click="cancel()">{{'label.button.cancel' | translate}}</button>
            <button id="save" type="submit" class="btn btn-primary">{{'label.button.save' | translate}}</button>
        </div>
    </form>
</div>