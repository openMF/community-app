<div ng-controller="ProductiveCollectionSheetController">
    <ul class="breadcrumb">
        <li><a href="#/entercollectionsheet">{{'label.anchor.collectionsheet' | translate}}</a></li>
        <li class="active">{{"label.button.productivecollectionsheet" | translate}}</li>
    </ul>
    <api-validate></api-validate>
    <div class="col-md-12 col-sm-12">
		<div class="row primarydiv">
			<h4 class="paddedleft pull-left" style="color:#FFFFFF; font-size:16px;">{{"label.button.productivecollectionsheet" | translate}}</h4>
			<div class="pull-right">
				<button class="btn btn-primary" style="font-size:16px; padding:8px;" ng-click="viewFullScreen()">
					<i class="icon-resize-full"></i>&nbsp;{{'label.button.viewfullscreen' | translate}}
				</button>
			</div>
		</div>
        <div id="productive_sheet" class="row client whitebg" style="min-width:1090px; min-height:850px;">
            <div class="paddedtop">
                <span>{{'label.heading.branch' | translate}}:&nbsp;{{officeName}}</span>
                <span class="paddedleft90">{{'label.input.meetingdate' | translate}}:&nbsp;{{meetingDate}}</span>
            </div>
            <div class="tabbable tabs-below paddedtop">
                <ul class="nav nav-tabs nav-pills">
                    <li ng-class="{statusactive: selectedTab == center.id}" ng-repeat="center in staffCenterData">
                        <a ng-click="getAllGroupsByCenter(center.id, center.collectionMeetingCalendar.id)">
                            {{center.name}}&nbsp;
                            <i ng-show="selectedTab == center.id && !center.submitted" class="icon-circle statusprogresstab"></i>
                            <i ng-show="selectedTab != center.id && !center.submitted" class="icon-circle statusprogresspendingtab"></i>
                            <i ng-show="center.submitted" class="icon-circle statusprogresscompletedtab"></i>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="paddedtop">
                <span>
                    <button id="add" class="btn btn-primary" ng-click="detailsShow()">
                        <i class="icon-plus-sign-alt icon-white" ng-hide="details"></i>
                        <i class="icon-minus-sign-alt icon-white" ng-show="details"></i>
                    </button>&nbsp;
                </span>
                <span class="graybg" ng-show="collectionsheetdata.loanProducts">
                    {{'label.input.centertotal' |  translate}}&nbsp;
                </span>
                <span style="height:30px" ng-repeat="loanproduct in collectionsheetdata.loanProducts">
                    <span ng-repeat="total in grandTotal" ng-show="loanproduct.id == total.productId">
						<input type="text" class="input-sm" ng-model="total.transactionAmount" disabled="disabled">
                    </span>
                </span>
            </div>
            <div class="paddedtop" ng-show="details">
				<div class="col-sm-5 col-md-5" style="padding-right:0px; padding-left:0px;">
					<table class="table table-bordered" ng-show="collectionsheetdata" data-anchor>
						<thead>
							<tr>
								<td colspan="3"><b>{{'label.heading.borrowername' | translate}}<b></td>
							</tr>
							<tr>
								<td colspan="2"><b>{{'label.heading.groups/clients' | translate}}</b></td>
								<td><b>{{'label.heading.attendance' | translate}}</b></td>
							</tr>								
						</thead>
						<tbody ng-repeat="group in collectionsheetdata.groups">
							<tr class="graybg">
								<td colspan="3"><b>{{group.groupName}}</b></td>
							</tr>
							<tr ng-repeat="client in group.clients">
								<td style="height:40px; width:10%;"><b>{{client.clientId}}</b></td>
								<td style="width:60%;">{{client.clientName}}</td>
								<td style="width:30%;">
									<select id="clientsAttendance[{{$index}}][attendanceType]"
									ng-model="client.attendanceType.id" class="input-sm form-control"
									ng-options="attendance.id as attendance.value for attendance in collectionsheetdata.attendanceTypeOptions"
									value="{{attendance.id}}">
									</select>
								</td>
							</tr>
							<tr>
								<td colspan="3" class="graybg" style="height:40px" ng-show="collectionsheetdata.loanProducts">
									<b>{{'label.input.grouptotal' | translate}}</b>
								</td>
								<td colspan="3" class="graybg" style="height:40px" ng-hide="collectionsheetdata.loanProducts">
									<span>&nbsp;</span>
								</td>
							</tr>
						</tbody>
						<tfoot>
							<tr>
								<td colspan="3" class="graybg" style="height:40px" ng-show="collectionsheetdata.loanProducts">
									<b>{{'label.input.total' | translate}}</b>
								</td>
								<td colspan="3" class="graybg" style="height:40px" ng-hide="collectionsheetdata.loanProducts">
									<span>&nbsp;</span>
								</td>
							</tr>
						</tfoot>
					</table>
				</div>
				<div class="col-sm-7 col-md-7" style="padding-left:0px;">
					<div style="float:left; max-width:665px; min-width:665px; overflow-x:auto!important; white-space:nowrap;">
						<table class="table table-bordered" ng-show="collectionsheetdata">
							<thead>
								<tr>
									<th class="highlightcol" scope="colgroup" 
										ng-show="collectionsheetdata.loanProducts"
										colspan="{{collectionsheetdata.loanProducts.length}}">
										{{'label.heading.duecollections' |  translate}}
									</th>
									<th class="highlightcol" scope="colgroup" 
										ng-show="collectionsheetdata.savingsProducts"
										colspan="{{collectionsheetdata.savingsProducts.length}}">
										{{'label.heading.due.savings.collections' |  translate}}
									</th>
									<th ng-show="collectionsheetdata.loanProducts || collectionsheetdata.savingsProducts">Client Collection</th>
								</tr>
								<tr>
									<th scope="colgroup" ng-repeat="loanproduct in collectionsheetdata.loanProducts">
										{{loanproduct.name}}/{{'label.heading.charges' | translate}}
									</th>
									<th scope="colgroup" ng-repeat="savingproduct in collectionsheetdata.savingsProducts">
										{{savingproduct.name}}
									</th>
									<th scope="colgroup" ng-show="collectionsheetdata.loanProducts || collectionsheetdata.savingsProducts">Line Total</th>
								</tr>
							</thead>
							<tbody ng-repeat="group in collectionsheetdata.groups">
								<tr>
									<td scope="colgroup" class="graybg" ng-show="collectionsheetdata.loanProducts" colspan="{{collectionsheetdata.loanProducts.length}}">&nbsp;</td>
									<td scope="colgroup" class="graybg" ng-show="collectionsheetdata.savingsProducts" colspan="{{collectionsheetdata.savingsProducts.length}}">&nbsp;</td>
									<td scope="colgroup" class="graybg" ng-show="collectionsheetdata.loanProducts || collectionsheetdata.savingsProducts">&nbsp;</td>
								</tr>
								<tr ng-repeat="client in group.clients">
									<td ng-repeat="loanproduct in collectionsheetdata.loanProducts" style="margin:0px; padding-left:0px; padding-right:0px">
										<table style="margin:0px; padding:0px; border:none;">
											<td style="white-space:nowrap; padding-left:0px; padding-right:0px" ng-repeat="loan in client.loans" ng-show="loanproduct.id == loan.productId">
												<table style="margin:0px; padding:0px; border:none;">
													<td>#{{loan.accountId}}&nbsp;:&nbsp;&nbsp;</td>
													<td>
														<input id="total" number-format type="text" class="input-sm form-control" style="min-width:150px;"
														ng-model="loan.totalDue" ng-change="sumTotalDueCollection()">														
													</td>
													<td>
														<input number-format type="text" class="input-sm form-control" style="min-width:100px;"
														ng-model="loan.chargesDue" ng-change="sumTotalDueCollection()">
													</td>
												</table>
											</td>
										</table>									
									</td>
									<td style="height:40px" ng-repeat="savingsproduct in collectionsheetdata.savingsProducts" style="margin:0px; padding-left:0px; padding-right:0px">
										<table style="margin:0px; padding:0px; border:none;">
											<td style="white-space:nowrap; padding-left:0px; padding-right:0px" ng-repeat="savings in client.savings" ng-show="savingsproduct.id == savings.productId">
												<table style="margin:0px; padding:0px; border:none;">
													<td>#{{savings.accountId}}&nbsp;:&nbsp;&nbsp;</td>
													<td>
														<input id="dueAmount" number-format type="text" class="input-sm form-control" style="min-width:150px;"
														ng-model="savings.dueAmount" ng-change="sumTotalDueCollection()">														
													</td>
												</table>
											</td>
										</table>
									</td>
									<td ng-show="collectionsheetdata.loanProducts || collectionsheetdata.savingsProducts" style="height:40px">
										<span>
											<div class="col-md-3">
												<input type="text" class="input-sm form-control" ng-value="0" disabled="disabled">
											</div>
										</span>
									</td>
								</tr>
								<tr>
									<td style="height:40px" class="graybg" ng-repeat="loanproduct in collectionsheetdata.loanProducts">
										<span ng-repeat="grouptotal in loanGroupsTotal"
										ng-show="grouptotal.groupId === group.groupId && loanproduct.id === grouptotal.productId">
											<b>{{grouptotal.dueAmount}}</b>
										</span>
									</td>
									<td style="height:40px" class="graybg" ng-repeat="savingsproduct in collectionsheetdata.savingsProducts">
										<span ng-repeat="grouptotal in savingsGroupsTotal"
										ng-show="grouptotal.groupId === group.groupId && savingsproduct.id === grouptotal.productId">
											<b>{{grouptotal.dueAmount}}</b>
										</span>
									</td>
									<td ng-show="collectionsheetdata.loanProducts || collectionsheetdata.savingsProducts" style="height:40px" class="graybg"><span><b>0</b></span></td>
								</tr>
							</tbody>
							<tfoot>
								<tr>
									<td style="height:40px" class="graybg" ng-repeat="loanproduct in collectionsheetdata.loanProducts">
										<span ng-repeat="total in loansTotal" ng-show="loanproduct.id == total.productId">
											<b>{{total.dueAmount}}</b>
										</span>
									</td>
									<td style="height:40px" class="graybg" ng-repeat="savingsproduct in collectionsheetdata.savingsProducts">
										<span ng-repeat="total in savingsTotal" ng-show="savingsproduct.id == total.productId">
											<b>{{total.dueAmount}}</b>
										</span>
									</td>
									<td ng-show="collectionsheetdata.loanProducts || collectionsheetdata.savingsProducts" style="height:40px" class="graybg"><span><b>0</b></span></td>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>			
					
	<!-- 		<table class="table table-bordered">
					<thead>
					<tr>
						<th></th>
						<th scope="colgroup" ng-repeat="loanproduct in collectionsheetdata.loanProducts">
							{{loanproduct.name}}/{{'label.heading.charges' | translate}}
						</th>
						<th>{{'label.heading.attendance' | translate}}</th>
					</tr>
					</thead>
					<tbody ng-repeat="group in collectionsheetdata.groups">
					<tr>
						<td class="graybg">
							<b>{{group.groupName}}</b>
						</td>
						<td scope="colgroup" colspan="{{collectionsheetdata.loanProducts.length}}">&nbsp;</td>
						<td colspan="1" scope="colgroup">&nbsp;</td>
					</tr>
					<tr ng-repeat="client in group.clients">
						<td>({{client.clientId}}){{client.clientName}}</td>
						<td ng-repeat="loanproduct in collectionsheetdata.loanProducts">
						  <span ng-repeat="loan in client.loans" ng-show="loanproduct.id == loan.productId">
							<input id="total" type="text" class="input-smaller" ng-model="loan.totalDue"
								   ng-change="bulkRepaymentTransactionAmountChange()">
						  </span>
						</td>
						<td>
							<select id="clientsAttendance[{{$index}}][attendanceType]" ng-model="client.attendanceType.id"
									class="input-smaller"
									ng-options="attendance.id as attendance.value for attendance in collectionsheetdata.attendanceTypeOptions"
									value="{{attendance.id}}">
							</select>
						</td>
					</tr>
					<tr>
						<td class="graybg" ng-show="collectionsheetdata.loanProducts">{{'label.input.grouptotal' | translate}}</td>
						<td ng-repeat="loanproduct in collectionsheetdata.loanProducts">
							<span ng-repeat="grouptotal in groupTotal" ng-show="grouptotal.groupId == group.groupId">
							  <span ng-repeat="loanProductArray in grouptotal.loanProductArrayDup"
									ng-show="loanproduct.id == loanProductArray.productId">
								<input type="text" class="input-smaller" ng-model="loanProductArray.transactionAmount"
									   disabled="disabled">
							  </span>
							</span>
						</td>
						<td></td>
					</tr>
					</tbody>
				</table>
 -->        </div>
            <div class="pull-left paddedtop">
                <button id="save" type="submit" class="btn btn-primary" ng-show="submitNextShow" ng-click="submit()">
                    <i class="icon-save"></i>&nbsp;{{'label.button.submitandnextcenter' | translate}}
                </button>
                <button id="save" type="submit" class="btn btn-primary" ng-show="submitShow" ng-click="submit()">
                    <i class="icon-save"></i>&nbsp;{{'label.button.save' | translate}}
                </button>
            </div>
        </div>
    </div>
</div>
